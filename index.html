<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OkEmby å…¬ç›ŠåŠ é€Ÿè®¡åˆ’ - è´Ÿè½½ç›‘æ§</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <style>
        /* æ–°å¢ï¼šå¼¹çª—ç›¸å…³æ ·å¼ */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-content { background: #25262b; width: 90%; max-width: 800px; padding: 25px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border: 1px solid #373a40; animation: fadeIn 0.3s ease; position: relative; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #444; padding-bottom: 15px; margin-bottom: 20px; }
        .modal-header h2 { margin: 0; color: #fff; font-size: 1.5rem; }
        .btn-close { background: none; border: none; font-size: 2rem; color: #888; cursor: pointer; line-height: 1; transition: color 0.2s; }
        .btn-close:hover { color: #fff; }
        
        /* å¼¹çª—å†…çš„ URL å¤åˆ¶åŒº */
        .proxy-url-box { background: #1a1b1e; padding: 15px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border: 1px solid #2c2e33; }
        .proxy-url-box code { color: #4caf50; font-family: monospace; font-size: 1.1rem; overflow-x: auto; margin-right: 10px; }
        
        /* æŒ‰é’®æ ·å¼å¾®è°ƒ */
        .btn-copy { background: #228be6; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; white-space: nowrap; }
        .btn-copy:hover { background: #1c7ed6; }
        .btn-recommend { background: linear-gradient(45deg, #4caf50, #228be6); color: white; border: none; padding: 12px 25px; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 1rem; box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3); transition: transform 0.2s; }
        .btn-recommend:hover { transform: translateY(-2px); }

        /* è¡¨æ ¼äº¤äº’ */
        tbody tr { cursor: pointer; transition: background 0.2s; }
        tbody tr:hover { background: #2c2e33; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Footer ä¿®å¤ */
        footer { text-align: center; padding: 30px 0; margin-top: 40px; color: #7a7a7a; font-size: 0.9rem; border-top: 1px solid #2c2e33; }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="container">
            <div class="logo">ğŸš€ OkEmby åŠ é€Ÿç›‘æ§</div>
            <a href="donate.html" class="btn-donate">â• æèµ èŠ‚ç‚¹ (åŠ å…¥å…±å»º)</a>
        </div>
    </nav>

    <div class="container main-content">
        
        <div class="card highlight-card" style="text-align: center; padding: 40px 20px;">
            <h2 style="margin-bottom: 10px;">âš¡ å¯»æ‰¾æœ€å¿«èŠ‚ç‚¹ï¼Ÿ</h2>
            <p style="color: #aaa; margin-bottom: 25px;">ç³»ç»Ÿä¼šæ ¹æ®å®æ—¶è´Ÿè½½ï¼Œä¸ºæ‚¨æ¨èå½“å‰æœ€ç©ºé—²ã€é€Ÿåº¦æœ€å¿«çš„åä»£èŠ‚ç‚¹ã€‚</p>
            <button onclick="recommendBestNode()" class="btn-recommend">ğŸ² ä¸€é”®è·å–ä»Šæ—¥æœ€ä½³èŠ‚ç‚¹</button>
            <p class="status-text" style="margin-top: 20px;">ğŸŸ¢ ç›‘æ§ç³»ç»ŸçŠ¶æ€ï¼š<span id="system-status">æ­£å¸¸è¿è¡Œä¸­ (å…±ç›‘æ§ 2 ä¸ªèŠ‚ç‚¹)</span></p>
        </div>

        <h3>ğŸ“Š èŠ‚ç‚¹å®æ—¶çŠ¶æ€ (ç‚¹å‡»åˆ—è¡¨æŸ¥çœ‹è¯¦æƒ…ä¸åœ°å€)</h3>
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>èŠ‚ç‚¹åç§°</th>
                        <th>çŠ¶æ€</th>
                        <th>ä»Šæ—¥æ¶ˆè€— (10wé™é¢)</th>
                        <th>è´Ÿè½½ç‡</th>
                        <th>ä¼˜é€‰æ®µ</th>
                    </tr>
                </thead>
                <tbody id="node-list">
                    <tr onclick="openNodeDetail('ç”¨æˆ·_9527', 'https://emby-9527.workers.dev', 12500)">
                        <td>ç”¨æˆ·_9527 (ç¤ºä¾‹)</td>
                        <td><span class="badge green">åœ¨çº¿</span></td>
                        <td>12,500 / 100,000</td>
                        <td>
                            <div class="progress-bar"><div class="fill" style="width: 12.5%"></div></div>
                        </td>
                        <td>Visa (104.18...)</td>
                    </tr>
                    <tr onclick="openNodeDetail('ç”¨æˆ·_Test', 'https://emby-test.workers.dev', 98000)">
                        <td>ç”¨æˆ·_Test (ç¤ºä¾‹)</td>
                        <td><span class="badge red">æ‹¥å µ</span></td>
                        <td>98,000 / 100,000</td>
                        <td>
                            <div class="progress-bar red"><div class="fill" style="width: 98%"></div></div>
                        </td>
                        <td>Shopify</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>æœ¬é¡¹ç›®ç”± OkEmby ç¤¾åŒºå…±å»º | æ•°æ®æ¯ 10 åˆ†é’Ÿåˆ·æ–°ä¸€æ¬¡</p>
        </div>
    </footer>

    <div id="detail-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">èŠ‚ç‚¹è¯¦æƒ…</h2>
                <button onclick="closeModal()" class="btn-close">Ã—</button>
            </div>
            
            <div class="modal-body">
                <p style="color: #aaa; margin-bottom: 10px;">ğŸ”— èŠ‚ç‚¹åä»£åœ°å€ (è¯·å¡«å…¥ Emby å®¢æˆ·ç«¯)ï¼š</p>
                <div class="proxy-url-box">
                    <code id="modal-url">https://...</code>
                    <button class="btn-copy" onclick="copyModalUrl()">å¤åˆ¶åœ°å€</button>
                </div>

                <p style="color: #aaa; margin-bottom: 10px;">ğŸ“ˆ 24å°æ—¶æµé‡è¶‹åŠ¿ï¼š</p>
                <div id="chart-requests" style="width: 100%; height: 300px;"></div>
            </div>
        </div>
    </div>

    <script>
        let myChart = null;

        // æ‰“å¼€å¼¹çª—å¹¶æ¸²æŸ“æ•°æ®
        function openNodeDetail(name, url, usage) {
            const modal = document.getElementById('detail-modal');
            const title = document.getElementById('modal-title');
            const urlCode = document.getElementById('modal-url');

            modal.style.display = 'flex';
            title.innerText = name + ' çš„è¯¦ç»†ç›‘æ§';
            urlCode.innerText = url;

            // åˆå§‹åŒ–æˆ–é‡ç½®å›¾è¡¨
            if (myChart != null && myChart != "" && myChart != undefined) {
                myChart.dispose(); // é”€æ¯æ—§å®ä¾‹ï¼Œé˜²æ­¢æ•°æ®æ®‹ç•™
            }
            myChart = echarts.init(document.getElementById('chart-requests'));

            // æ¨¡æ‹Ÿç”Ÿæˆä¸€äº›å›¾è¡¨æ•°æ® (å®é™…é¡¹ç›®ä¸­è¿™é‡Œä¼šfetchåç«¯API)
            const hours = ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', 'Now'];
            const data = [120, 132, 101, 134, 90, 230, usage/100]; // éšä¾¿ç”Ÿæˆçš„å‡æ•°æ®

            const option = {
                tooltip: { trigger: 'axis' },
                grid: { top: '10%', left: '3%', right: '4%', bottom: '3%', containLabel: true },
                xAxis: { type: 'category', boundaryGap: false, data: hours, axisLine: { lineStyle: { color: '#888' } } },
                yAxis: { type: 'value', splitLine: { lineStyle: { color: '#333' } }, axisLine: { lineStyle: { color: '#888' } } },
                series: [{
                    name: 'è¯·æ±‚æ•°',
                    type: 'line',
                    smooth: true,
                    itemStyle: { color: '#4caf50' },
                    areaStyle: { color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{offset: 0, color: 'rgba(76, 175, 80, 0.5)'}, {offset: 1, color: 'rgba(76, 175, 80, 0)'}]) },
                    data: data
                }]
            };
            myChart.setOption(option);
            
            // å“åº”çª—å£å¤§å°å˜åŒ–
            window.addEventListener('resize', function() { myChart.resize(); });
        }

        // å…³é—­å¼¹çª—
        function closeModal() {
            document.getElementById('detail-modal').style.display = 'none';
        }

        // å¤åˆ¶å¼¹çª—é‡Œçš„ URL
        function copyModalUrl() {
            const url = document.getElementById('modal-url').innerText;
            navigator.clipboard.writeText(url).then(() => alert('èŠ‚ç‚¹åœ°å€å·²å¤åˆ¶ï¼'));
        }

        // æ¨¡æ‹Ÿâ€œæ™ºèƒ½æ¨èâ€é€»è¾‘
        function recommendBestNode() {
            // è¿™é‡Œä»¥åå¯ä»¥å†™é€»è¾‘éå†åˆ—è¡¨ï¼Œæ‰¾ usage æœ€å°çš„é‚£ä¸ª
            // ç°åœ¨å…ˆæ¼”ç¤ºç›´æ¥æ‰“å¼€ç¬¬ä¸€ä¸ª
            openNodeDetail('ç”¨æˆ·_9527 (æ¨è)', 'https://emby-9527.workers.dev', 12500);
            alert('ğŸ‰ å·²ä¸ºæ‚¨è‡ªåŠ¨æ¨èå½“å‰è´Ÿè½½æœ€ä½çš„èŠ‚ç‚¹ï¼');
        }

        // ç‚¹å‡»é®ç½©å±‚ä¹Ÿå¯ä»¥å…³é—­
        document.getElementById('detail-modal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });
    </script>
</body>
</html>